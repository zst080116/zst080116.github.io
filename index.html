<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜Ÿè¾°æ¸¸æˆå·¥ä½œå®¤</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ®</text></svg>">
    <style>
        /* ä¹‹å‰çš„æ‰€æœ‰CSSæ ·å¼ä¿æŒä¸å˜... */
        
        /* æ·»åŠ faviconæ§åˆ¶é¢æ¿æ ·å¼ */
        .favicon-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            color: white;
            font-size: 12px;
            display: none; /* é»˜è®¤éšè—ï¼Œå¼€å‘æ—¶å¯è§ */
        }
    </style>
</head>
<body>
    <!-- ä¹‹å‰çš„æ‰€æœ‰HTMLå†…å®¹ä¿æŒä¸å˜... -->

    <!-- åœ¨é¡µé¢åº•éƒ¨æ·»åŠ æ§åˆ¶é¢æ¿ï¼ˆå¼€å‘è°ƒè¯•ç”¨ï¼‰ -->
    <div class="favicon-controls">
        <button onclick="cubeFavicon.toggleRotation()">åˆ‡æ¢æ—‹è½¬</button>
        <button onclick="cubeFavicon.setSpeed(1)">æ…¢é€Ÿ</button>
        <button onclick="cubeFavicon.setSpeed(3)">å¿«é€Ÿ</button>
    </div>

    <script>
        // 3Dç«‹æ–¹ä½“Faviconæ—‹è½¬ç³»ç»Ÿ
        class CubeFavicon {
          constructor() {
            // é…ç½®å‚æ•°
            this.config = {
              size: 32,     // å›¾æ ‡å°ºå¯¸
              speed: 2,     // æ—‹è½¬é€Ÿåº¦
              scale: 10     // ç«‹æ–¹ä½“å¤§å°
            };
            
            // åˆå§‹åŒ–ç”»å¸ƒ
            this.canvas = document.createElement('canvas');
            this.canvas.width = this.config.size;
            this.canvas.height = this.config.size;
            this.ctx = this.canvas.getContext('2d');
            
            // è®¾ç½®favicon
            this.favicon = document.querySelector("link[rel='icon']") || 
                          document.createElement('link');
            this.favicon.rel = 'icon';
            document.head.appendChild(this.favicon);
            
            // ç«‹æ–¹ä½“é¡¶ç‚¹æ•°æ®
            this.vertices = [
              [-1,-1,-1], [1,-1,-1], [1,1,-1], [-1,1,-1], // åé¢
              [-1,-1,1], [1,-1,1], [1,1,1], [-1,1,1]     // å‰é¢
            ];
            
            // ç«‹æ–¹ä½“é¢æ•°æ® [é¡¶ç‚¹ç´¢å¼•, é¢œè‰²]
            this.faces = [
              [0,1,2,3, '#3498db'], // åé¢
              [4,5,6,7, '#2980b9'], // å‰é¢
              [1,5,6,2, '#1abc9c'], // å³é¢
              [0,4,7,3, '#9b59b6'], // å·¦é¢
              [3,7,6,2, '#e74c3c'], // é¡¶é¢
              [0,4,5,1, '#f1c40f']  // åº•é¢
            ];
            
            // æ—‹è½¬çŠ¶æ€
            this.angleX = 20;
            this.angleY = 30;
            this.isRotating = true;
            
            // å¼€å§‹åŠ¨ç”»
            this.animate();
          }
          
          // é¡¶ç‚¹æ—‹è½¬è®¡ç®—
          rotateVertex(x, y, z) {
            // Xè½´æ—‹è½¬
            const cosX = Math.cos(this.angleX * Math.PI/180);
            const sinX = Math.sin(this.angleX * Math.PI/180);
            const y1 = y * cosX - z * sinX;
            const z1 = y * sinX + z * cosX;
            
            // Yè½´æ—‹è½¬
            const cosY = Math.cos(this.angleY * Math.PI/180);
            const sinY = Math.sin(this.angleY * Math.PI/180);
            const x1 = x * cosY + z1 * sinY;
            const z2 = -x * sinY + z1 * cosY;
            
            return { x: x1, y: y1, z: z2 };
          }
          
          // ç»˜åˆ¶ç«‹æ–¹ä½“
          drawCube() {
            // æ¸…ç©ºç”»å¸ƒ
            this.ctx.clearRect(0, 0, this.config.size, this.config.size);
            this.ctx.fillStyle = '#2c3e50';
            this.ctx.fillRect(0, 0, this.config.size, this.config.size);
            
            // ç»˜åˆ¶æ¯ä¸ªé¢
            this.faces.forEach(face => {
              const [a,b,c,d, color] = face;
              
              // è·å–æ—‹è½¬åçš„é¡¶ç‚¹
              const p1 = this.rotateVertex(...this.vertices[a]);
              const p2 = this.rotateVertex(...this.vertices[b]);
              const p3 = this.rotateVertex(...this.vertices[c]);
              const p4 = this.rotateVertex(...this.vertices[d]);
              
              // èƒŒé¢å‰”é™¤
              const normal = (p2.y - p1.y) * (p3.z - p1.z) - (p2.z - p1.z) * (p3.y - p1.y);
              if (normal < 0) return;
              
              // 2DæŠ•å½±
              const center = this.config.size / 2;
              const project = p => ({
                x: center + p.x * this.config.scale,
                y: center + p.y * this.config.scale
              });
              
              // ç»˜åˆ¶é¢
              this.ctx.fillStyle = color;
              this.ctx.beginPath();
              this.ctx.moveTo(project(p1).x, project(p1).y);
              this.ctx.lineTo(project(p2).x, project(p2).y);
              this.ctx.lineTo(project(p3).x, project(p3).y);
              this.ctx.lineTo(project(p4).x, project(p4).y);
              this.ctx.closePath();
              this.ctx.fill();
            });
            
            // æ›´æ–°favicon
            this.favicon.href = this.canvas.toDataURL('image/png');
          }
          
          // åŠ¨ç”»å¾ªç¯
          animate() {
            if (this.isRotating) {
              this.angleY += this.config.speed;
              this.angleX += this.config.speed * 0.5;
            }
            
            this.drawCube();
            requestAnimationFrame(() => this.animate());
          }
          
          // æ§åˆ¶æ–¹æ³•
          toggleRotation() {
            this.isRotating = !this.isRotating;
          }
          
          setSpeed(speed) {
            this.config.speed = speed;
          }
          
          setColors(colors) {
            this.faces.forEach((face, i) => {
              face[4] = colors[i] || face[4];
            });
          }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–3D Favicon
        document.addEventListener('DOMContentLoaded', function() {
            const cubeFavicon = new CubeFavicon();
            
            // å°†å®ä¾‹æš´éœ²ç»™å…¨å±€ï¼Œæ–¹ä¾¿è°ƒè¯•
            window.cubeFavicon = cubeFavicon;
            
            // å½“é¡µé¢å¤±å»ç„¦ç‚¹æ—¶æš‚åœæ—‹è½¬
            window.addEventListener('blur', function() {
                cubeFavicon.toggleRotation();
            });
            
            // å½“é¡µé¢é‡æ–°è·å¾—ç„¦ç‚¹æ—¶æ¢å¤æ—‹è½¬
            window.addEventListener('focus', function() {
                if (!cubeFavicon.isRotating) {
                    cubeFavicon.toggleRotation();
                }
            });
        });
    </script>
</body>
</html>
